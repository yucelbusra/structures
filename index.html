<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Structural Engineer Roleplay</title>
  <style>
    /* --- CSS STYLES --- */
    body { margin: 0; font-family: sans-serif; background-color: #cce7f6; }
    
    /* Layout */
    .screen { display: none; min-height: 100vh; width: 100vw; flex-direction: column; align-items: center; text-align: center; padding: 20px; box-sizing: border-box; }
    .active { display: flex; }
    
    /* Progress Bar */
    #progressBar { display: flex; gap: 20px; margin: 20px 0 40px 0; justify-content: center; flex-wrap: wrap; }
    .step { padding: 8px 12px; border-radius: 8px; background: #ccc; font-weight: bold; color: #fff; font-size: 0.9em; }
    .step.active { background: #0077cc; }
    .step.completed { background: #2ecc71; }

    /* Inputs & Buttons */
    input, select { padding: 8px; margin: 5px 0 15px 0; width: 180px; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 10px 20px; font-size: 16px; border: none; border-radius: 8px; background-color: #0077cc; color: #fff; cursor: pointer; margin-top: 10px; }
    button:hover { background-color: #005fa3; }
    button:disabled { background-color: #999; cursor: not-allowed; }

    /* Canvas & Images */
    canvas { border: 1px solid #888; margin-top: 20px; background: white; max-width: 100%; }
    img.load-icon { height: 30px; display: none; vertical-align: middle; }

    /* --- BADGE FIX --- */
    #badgeBar { 
        display: flex; 
        gap: 15px; 
        justify-content: center; 
        margin-bottom: 20px; 
        min-height: 60px; 
        flex-wrap: wrap; 
    }
    
    .badge-wrapper {
        position: relative;
        width: 60px;  /* FIXED WIDTH */
        height: 60px; /* FIXED HEIGHT */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .badge {
        width: 60px !important;  /* Force small size */
        height: 60px !important; /* Force small size */
        border-radius: 10px;
        border: 2px solid #ddd;
        background: #fff;
        object-fit: contain;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .badge.locked { filter: grayscale(100%) opacity(0.5); }
    
    .lock-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 24px;
        height: 24px;
        opacity: 0.7;
        pointer-events: none;
    }

    /* Calculation Cards */
    .input-card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: inline-block; vertical-align: top; margin: 10px; width: 220px; text-align: left; }
    .input-card label { font-weight: bold; display: block; margin-bottom: 5px; }
    .input-card small { color: #666; font-size: 0.85em; display:block; margin-bottom:5px; }
    
    /* Sequential Steps */
    .calc-block { margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.7); border-radius: 8px; border: 1px solid #ddd; display: none; width: 100%; max-width: 600px; }

    /* Feedback Box */
    .feedback-box { margin-top: 10px; padding: 10px; border-radius: 5px; display: none; text-align: left; }
    
    /* Notification */
    #badgeNotification { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px 40px; background-color: rgba(0, 119, 204, 0.95); color: white; border-radius: 10px; z-index: 2000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-size: 1.5em; font-weight: bold; text-align: center; }
    @keyframes fadeInOut { 0% { opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { opacity: 0; display: none; } }
  </style>
</head>
<body>
  
  <div id="progressBar">
    <div class="step" id="step1">üîπ Intro</div>
    <div class="step" id="step2">üìè Slab</div>
    <div class="step" id="step3">üìä Loads</div>
    <div class="step" id="step4">‚öñÔ∏è Design</div>
    <div class="step" id="step5">üéì Summary</div>
  </div>

  <div id="badgeBar"></div>

  <div id="introScreen" class="screen active">
    <h1>üßë‚Äçüîß Welcome, Construction Managers!</h1>
    <img src="./img/welcome.gif" alt="Welcome" style="max-width:300px; margin:15px;">
    <p>
      Your task is to design timber beams for a sustainable building project.<br>
      Start by entering your slab design parameters.
    </p>
    <p style="font-size: 0.85em; opacity: 0.85; margin-top: 12px;">
      <strong>Disclaimer:</strong> This tool is an educational research prototype.
    </p>
    <button id="continueBtn">I'm Ready! ‚Üí</button>
  </div>

  <div id="canvasScreen" class="screen">
    <div style="display:flex; gap:40px; align-items:flex-start; flex-wrap:wrap; justify-content:center;">
      <div style="text-align:left;">
        <h2>Slab Design Parameters</h2>
        <label>Width of Slab (W) (ft):</label><br>
        <input type="number" id="inputWidth" step="0.1"><br>
        <label>Length of Slab (L) (ft):</label><br>
        <input type="number" id="inputLength" step="0.1"><br>
        <label>Number of Beams:</label><br>
        <input type="number" id="inputBeamCount" step="1" min="2"><br>
        <p id="spacingInfo" style="margin-top:10px; font-weight:bold; color:#0077cc;"></p>
        <button id="drawCanvasBtn">Visualize Design</button>
        <br>
        <button id="backBtn" style="background:#777;">‚Üê Back</button>
      </div>
      <div>
        <img src="./img/SlabDimensions.png" alt="Slab illustration" style="max-width:250px; display:block; margin-bottom:10px;">
        <canvas id="slabCanvas" width="400" height="400"></canvas>
      </div>
    </div>
    <button id="continueToLoadBtn" style="margin-top:20px;">Continue ‚Üí</button>
  </div>

  <div id="loadScreen" class="screen">
    <div style="display:flex; gap:30px; align-items:flex-start; flex-wrap:wrap; justify-content:center;">
      <div style="text-align:left;">
        <h2>Load Parameters (psi)</h2>
        
        <label>Permanent (Dead) Load:</label><br>
        <input type="number" id="permanentLoad" step="0.1">
        <img id="imgPermanent" src="./img/load-permanent.png" class="load-icon"><br>

        <label>Snow Load:</label><br>
        <input type="number" id="snowLoad" step="0.1">
        <img id="imgSnow" src="./img/load-snow.png" class="load-icon"><br>

        <label>Wind Load:</label><br>
        <input type="number" id="windLoad" step="0.1">
        <img id="imgWindPositive" src="./img/load-wind.png" class="load-icon">
        <img id="imgWindNegative" src="./img/load-wind-negative.png" class="load-icon"><br>

        <label>Mobile (Live) Load:</label><br>
        <input type="number" id="mobileLoad" step="0.1">
        <img id="imgMobile" src="./img/load-mobile.png" class="load-icon"><br>
        
        <button id="backToSlabBtn" style="background:#777;">‚Üê Back</button>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center;">
          <canvas id="loadCanvas" width="400" height="400"></canvas>
          <div id="combinedLoadImage" style="display:none; text-align:center; margin:10px 0;"></div>
          <button id="toggleCombinedBtn" style="display:none; margin:10px; font-size:14px;">Show Combined Loads</button>
          
          <div style="margin-top:15px; padding:15px; border:2px dashed #0077cc; border-radius:10px; background:white; width:280px;">
            <h3 style="margin:0 0 10px 0; font-size:1.1em;">Total Design Load</h3>
            <small>Sum of all entered loads (psi)</small><br>
            <input type="number" id="inputTotalLoad" step="0.1" style="width:100px;">
            <button id="checkTotalLoadBtn" style="margin-top:0; padding:8px 15px; font-size:14px;">Check</button>
            <div id="loadFeedback" class="feedback-box"></div>
            <button type="button" id="continueToTributaryBtn" style="display:none; width:100%; margin-top:10px; background-color:#2ecc71;">Continue ‚Üí</button>
          </div>
      </div>
    </div>
  </div>

  <div id="tributaryScreen" class="screen">
    <h2>Design Calculation Phase</h2>

    <div style="display:flex; gap:40px; align-items:flex-start; flex-wrap:wrap; justify-content:center;">
      <div style="text-align:center;">
        <canvas id="loadCanvasPreview" width="300" height="300"></canvas>
        <div id="combinedImagePreview" style="margin-top:10px;"></div>
      </div>

      <div style="text-align:left; min-width:300px; max-width:600px;">
        
        <div id="step1_trib" style="background:white; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1);">
            <h3 style="margin-top:0;">Step 1: Tributary Width</h3>
            <label>Choose Beam:</label><br>
            <select id="beamSelect"></select><br>
            <label>Enter Tributary Width (ft):</label><br>
            <input type="number" id="tributaryWidth" step="0.1"><br>
            <button id="submitTribBtn">Check Width</button>
            <div id="tribFeedback" class="feedback-box"></div>
            <img id="feedbackGif" style="display:none; max-width:150px; margin-top:10px;">
        </div>

        <div id="step2_lineLoad" class="calc-block">
            <h3 style="margin-top:0;">Step 2: Line Load ($w$)</h3>
            <p style="margin:5px 0 15px 0;">Formula: Total Load (psi) √ó Tributary Width (ft)</p>
            <label>Line Load ($w$) (lbs/ft):</label><br>
            <input type="number" id="inputLineLoad" step="0.1"><br>
            <button id="checkLineLoadBtn">Check Line Load</button>
            <div id="lineLoadFeedback" class="feedback-box"></div>
        </div>

        <div id="step3_forces" class="calc-block">
            <h3 style="margin-top:0;">Step 3: Forces & Deflection</h3>
            <p style="margin:5px 0;">Use verified $w$ and span $L$.</p>

            <div style="display:flex; flex-wrap:wrap; gap:10px;">
                <div class="input-card">
                    <label>Max Shear ($V_{max}$)</label>
                    <small>Unit: lbs (wL/2)</small>
                    <input type="number" id="inputVmax" step="0.1" style="width:180px;">
                </div>

                <div class="input-card">
                    <label>Max Moment ($M_{max}$)</label>
                    <small>Unit: lbs-ft (wL¬≤/8)</small>
                    <input type="number" id="inputMmax" step="0.1" style="width:180px;">
                </div>
                
                <div class="input-card">
                    <label>Deflection ($\delta_{max}$)</label>
                    <small>Unit: inches</small>
                    <input type="number" id="inputDelta" step="0.001" style="width:180px;">
                </div>
            </div>

            <button id="checkForcesBtn" style="width:100%; margin-top:15px; background:#27ae60;">Verify Design</button>
            <div id="forcesFeedback" class="feedback-box"></div>
        </div>

        <button id="continueToSummaryBtn" style="margin-top:20px; display:none; width:100%;">Finish ‚Üí Summary</button>

      </div>
    </div>
  </div>

  <div id="resultScreen" class="screen">
    <h2>üèÅ Final Score</h2>
    <div id="finalScore" style="background:white; padding:30px; border-radius:10px; text-align:left;"></div>
    <button onclick="location.reload()" style="margin-top:20px;">Start Over</button>
  </div>

  <div id="badgeNotification"></div>

  <audio id="clickSound" src="./sounds/click.mp3"></audio>
  <audio id="successSound" src="./sounds/success.wav"></audio>
  <audio id="errorSound" src="./sounds/error.wav"></audio>
  <audio id="badgeSound" src="./sounds/badge.mp3"></audio>

  <script src="deneme4.js"></script>
</body>
</html>
